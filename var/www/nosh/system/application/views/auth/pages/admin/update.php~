<script type="text/javascript">
var timeoutHnd;
	
function doSearch(ev){ 
	if(timeoutHnd) 
		clearTimeout(timeoutHnd);
		timeoutHnd = setTimeout(gridReload,500);
}

function gridReload(){ 
	var mask = jQuery("#search_all_cpt").val();
	jQuery("#cpt_list").setGridParam({url:"<?php echo site_url('admin/setup/cpt_list');?>/"+mask,page:1}).trigger("reloadGrid");
}

$(document).ready(function() {
	$("#add_medlist_file").click(function(){
		var id = '1';
		$.ajax({
			type: "POST",
			url: "<?php echo site_url('admin/setup/medlist_update');?>",
			data: "id=" + id,
			success: function(data){
				$.jGrowl(data);
			}
		});
	});
	
	$("#add_icd_file").click(function(){
		var id = '1';
		$.ajax({
			type: "POST",
			url: "<?php echo site_url('admin/setup/icd_update');?>",
			data: "id=" + id,
			success: function(data){
				$.jGrowl(data.result);
			}
		});
	});
	
	new AjaxUpload('#add_cpt_file', {
		action: "<?php echo site_url('admin/setup/cpt_update');?>",
		name: 'fileToUpload',
		autoSubmit: true,
		responseType: 'json',
		onComplete: function(file, data) {
			$.jGrowl(data.result);
		}
	});
	$("#add_cpt_upload").button();
	$("#add_npi_upload").button();
	$("#add_npi_file").click(function(){
		var id = '1';
		$.ajax({
			type: "POST",
			url: "<?php echo site_url('admin/setup/npi_update');?>",
			data: "id=" + id,
			success: function(data){
				$.jGrowl(data);
			}
		});
	});
	$("#add_cvx_file").click(function(){
		var id = '1';
		$.ajax({
			type: "POST",
			url: "<?php echo site_url('admin/setup/cvx_update');?>",
			data: "id=" + id,
			success: function(data){
				$.jGrowl(data);
			}
		});
	});
	jQuery("#cpt_list").jqGrid({
		url:"<?php echo site_url('admin/setup/cpt_list');?>",
		editurl:"<?php echo site_url('admin/setup/edit_cpt_list');?>",
		datatype: "json",
		mtype: "POST",
		colNames:['ID','CPT Code','Description','Charge'],
		colModel:[
			{name:'cpt_id',index:'cpt_id',width:1,hidden:true},
			{name:'cpt',index:'cpt',width:100,editable:true,editrules:{required:true},formoptions:{elmsuffix:"(*)"}},
			{name:'cpt_description',index:'cpt_description',width:700,editable:true,editrules:{required:true},edittype:"textarea",editoptions:{rows:"4",cols:"50"},formoptions:{elmsuffix:"(*)"}},
			{name:'cpt_charge',index:'cpt_charge',width:100,editable:true,editrules:{required:true},formoptions:{elmsuffix:"(*)"}},
		],
		rowNum:10,
		rowList:[10,20,30],
		pager: jQuery('#cpt_list_pager'),
		sortname: 'cpt',
	 	viewrecords: true,
	 	sortorder: "asc",
	 	caption:"CPT Codes",
	 	emptyrecords:"No cpt codes",
	 	height: "100%",
	 	jsonReader: { repeatitems : false, id: "0" }
	}).navGrid('#cpt_list_pager',{edit:false,add:false,del:false
	});
	$("#add_cpt").button().click(function(){
		jQuery("#cpt_list").editGridRow("new",{closeAfterAdd:true,width:'550',bottominfo:'Fields marked in (*) are required.'});	
	});
	
	$("#edit_cpt").button().click(function(){
		var item = jQuery("#cpt_list").getGridParam('selrow');
		if(item){ 
			jQuery("#cpt_list").editGridRow(item,{closeAfterEdit:true,width:'550',bottominfo:'Fields marked in (*) are required.'});
		} else {
			$.jGrowl("Please select CPT code to edit!");
		}
	});
	
	$("#delete_cpt").button().click(function(){
		var item = jQuery("#cpt_list").getGridParam('selrow');
		if(item){
			$.ajax({
				type: "POST",
				url: "<?php echo site_url('admin/setup/delete_cpt');?>",
				data: "cpt_id=" + item,
				success: function(data){
					jQuery("#cpt_list").trigger("reloadGrid");
				}
			});
		} else {
			$.jGrowl("Please select CPT code to delete!");
		}
	});
});
</script>
<img id="loading" src="<?php echo base_url().'static/images/indicator.gif';?>" style="display:none;">
<fieldset class="ui-corner-all">
	<legend>Medication List Update</legend>
	Downloads .zip file from <a href="http://www.fda.gov/Drugs/InformationOnDrugs/ucm142438.htm#download" target="_blank">the FDA NDC databases.</a><br><br>
	<input type="button" id="add_medlist_file" value="Update Medication List Database" class="ui-button ui-state-default ui-corner-all"/>
</fieldset><br>
<fieldset class="ui-corner-all">
	<legend>ICD Database Update</legend>
	Scrape data from <a href="http://www.icd9data.com" target="_blank">www.icd9data.com</a>:<br>
	Imports data into database.<br><br>
	<input type="button" id="add_icd_file" value="Update ICD Database" class="ui-button ui-state-default ui-corner-all"/>
</fieldset><br>
<fieldset class="ui-corner-all">
	<legend>CPT Database Update</legend>
	Comma-separated values (csv) file with the following index with tab as delimiter: cpt code,cpt description<br><br>
	<form id="add_cpt_form" action="<?php echo site_url('admin/setup/cpt_update');?>" method="post" enctype="multipart/form-data">
		<span id="add_cpt_span"><input type="file" name="fileToUpload" id="fileToUpload"> <input type="submit" id="add_cpt_upload" value="Upload"></span>
	</form>
	<br><br>
	Search: <input type="text" size="50" id="search_all_cpt" class="text ui-widget-content ui-corner-all" onkeydown="doSearch(arguments[0]||event)"/><br><br> 
	<table id="cpt_list" class="scroll" cellpadding="0" cellspacing="0"></table>
	<div id="cpt_list_pager" class="scroll" style="text-align:center;"></div><br>
	<input type="button" id="add_cpt" value="Add CPT Code"/>
	<input type="button" id="edit_cpt" value="Edit CPT Code"/>
	<input type="button" id="delete_cpt" value="Delete CPT Code"/><br><br>
</fieldset><br>
<fieldset class="ui-corner-all">
	<legend>NPI Taxonomy List Update</legend>
	Download .csv file from <a href="http://www.nucc.org/" target="_blank">the National Uniform Claim Committee website and click Code Sets, then Provider Taxonomy, then CSV.</a><br>
	Import the new .csv file into database here...<br><br>
	<form id="add_npi_form" action="<?php echo site_url('admin/setup/npi_update');?>" method="post" enctype="multipart/form-data">
		<span id="add_npi_span"><input type="file" name="fileToUpload1" id="fileToUpload1"> <input type="submit" id="add_npi_upload" value="Upload"></span>
	</form>
</fieldset><br>
<fieldset class="ui-corner-all">
	<legend>CVX Update</legend>
	Imports data from <a href="http://www2a.cdc.gov/vaccines/iis/iisstandards/XML.asp?rpt=cvx" target="_blank">the CDC website.</a><br><br>
	<input type="button" id="add_cvx_file" value="Update CVX Database" class="ui-button ui-state-default ui-corner-all"/>
</fieldset>

